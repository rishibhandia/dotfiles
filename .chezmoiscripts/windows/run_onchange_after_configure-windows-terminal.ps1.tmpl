{{- if eq .chezmoi.os "windows" -}}
#!/usr/bin/env pwsh
# Configure Windows Terminal with Catppuccin Macchiato theme
# Hash: {{ include "dot_config/windows-terminal/catppuccin-macchiato.json" | sha256sum }}

$ErrorActionPreference = "Stop"

# Windows Terminal settings path
$WTSettingsPath = "$env:LOCALAPPDATA\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json"

if (-not (Test-Path $WTSettingsPath)) {
    Write-Host "Windows Terminal not found, skipping configuration" -ForegroundColor Yellow
    exit 0
}

Write-Host "Configuring Windows Terminal..." -ForegroundColor Cyan

# Read current settings
$settings = Get-Content $WTSettingsPath -Raw | ConvertFrom-Json

# Catppuccin Macchiato color scheme
$catppuccinScheme = @{
    name            = "Catppuccin Macchiato"
    cursorColor     = "#F4DBD6"
    selectionBackground = "#3A3E53"
    background      = "#24273A"
    foreground      = "#CAD3F5"
    black           = "#494D64"
    red             = "#ED8796"
    green           = "#A6DA95"
    yellow          = "#EED49F"
    blue            = "#8AADF4"
    purple          = "#F5BDE6"
    cyan            = "#8BD5CA"
    white           = "#A5ADCB"
    brightBlack     = "#5B6078"
    brightRed       = "#ED8796"
    brightGreen     = "#A6DA95"
    brightYellow    = "#EED49F"
    brightBlue      = "#8AADF4"
    brightPurple    = "#F5BDE6"
    brightCyan      = "#8BD5CA"
    brightWhite     = "#B8C0E0"
}

# Ensure schemes array exists
if (-not $settings.schemes) {
    $settings | Add-Member -NotePropertyName "schemes" -NotePropertyValue @()
}

# Remove existing Catppuccin Macchiato scheme if present
$settings.schemes = @($settings.schemes | Where-Object { $_.name -ne "Catppuccin Macchiato" })

# Add our scheme
$settings.schemes += $catppuccinScheme

# Ensure profiles.defaults exists
if (-not $settings.profiles) {
    $settings | Add-Member -NotePropertyName "profiles" -NotePropertyValue @{}
}
if (-not $settings.profiles.defaults) {
    $settings.profiles | Add-Member -NotePropertyName "defaults" -NotePropertyValue @{}
}

# Set default color scheme
$settings.profiles.defaults | Add-Member -NotePropertyName "colorScheme" -NotePropertyValue "Catppuccin Macchiato" -Force

# Set default font (Hack Nerd Font from Scoopfile)
$fontConfig = @{
    face = "Hack Nerd Font"
    size = 12
}
$settings.profiles.defaults | Add-Member -NotePropertyName "font" -NotePropertyValue $fontConfig -Force

# Write settings back (preserve formatting)
$settings | ConvertTo-Json -Depth 100 | Set-Content $WTSettingsPath -Encoding UTF8

Write-Host "Windows Terminal configured with Catppuccin Macchiato theme" -ForegroundColor Green
{{- end }}
