# -*-mode:bash-*- vim:ft=bash
#
# ~/.zshenv
#
{{- /* Template for .zshenv */ -}}

#If debug flag enabled (ZSH_DEBUG = 1), will print file path and name when sourced
[ ! -z "$ZSH_DEBUG" ] && printf "Sourcing file %s (path: %s)\n" "${(%):-%N}" "${(%):-%x}"

###############################
# EXPORT ENVIRONMENT VARIABLE #
###############################
{{- if eq .chezmoi.os "darwin" }}
export TERM='xterm-256color'
{{- else }}
export TERM='rxvt-256color'
{{- end }}
export COLORTERM='truecolor'

# XDG
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$XDG_CONFIG_HOME/cache"
export XDG_STATE_HOME="$HOME/.local/state"

# editor
export EDITOR="nvim"
export VISUAL="nvim"

# zsh
# Setting ZDOTDIR so zsh doesn't make stuff in HOME dir
export ZDOTDIR="$XDG_CONFIG_HOME/zsh"
export HISTFILE="$ZDOTDIR/.zhistory"    # History filepath
export HISTSIZE=10000                   # Maximum events for internal history
export SAVEHIST=10000                   # Maximum events in history file
setopt HIST_IGNORE_DUPS
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt EXTENDED_HISTORY

# Various Applications
export SCREENSHOT="$HOME/Pictures/screenshots"
export VIMCONFIG="$XDG_CONFIG_HOME/nvim"

# Homebrew
{{- if eq .chezmoi.os "darwin" }}
{{-   if eq .chezmoi.arch "arm64" }}
# Apple Silicon Mac
eval "$(/opt/homebrew/bin/brew shellenv)"
{{-   else }}
# Intel Mac
eval "$(/usr/local/bin/brew shellenv)"
{{-   end }}
{{- else if eq .chezmoi.os "linux" }}
# Linux
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
{{- end }}

# Local bin
export PATH="$HOME/.local/bin:$PATH"

{{- if .personal }}
# API Keys from 1Password (personal machines only)
{{- with (onepassword "OpenAI API Key").fields -}}
{{- range . -}}
{{- if eq .id "credential" }}
export OPENAI_API_KEY="{{ .value }}"
{{- end -}}
{{- end -}}
{{- end }}

{{- with (onepassword "OpenRouter API Key").fields -}}
{{- range . -}}
{{- if eq .id "credential" }}
export OPENROUTER_API_KEY="{{ .value }}"
{{- end -}}
{{- end -}}
{{- end }}

export OPENROUTER_KEY="$OPENROUTER_API_KEY"
export LLM_OPENROUTER_KEY="$OPENROUTER_KEY"

{{- with (onepassword "Anthropic API Key").fields -}}
{{- range . -}}
{{- if eq .id "credential" }}
export ANTHROPIC_API_KEY="{{ .value }}"
{{- end -}}
{{- end -}}
{{- end }}

{{- with (onepassword "Google Gemini API Key").fields -}}
{{- range . -}}
{{- if eq .id "credential" }}
export LLM_GEMINI_KEY="{{ .value }}"
{{- end -}}
{{- end -}}
{{- end }}

# SSH agent for 1Password
{{- if eq .chezmoi.os "darwin" }}
export SSH_AUTH_SOCK=~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock
{{- end }}
{{- end }}

# Cargo
. "$HOME/.cargo/env"


#AIDER editor
export AIDER_EDITOR="code --wait"
export AIDER_MODEL="openrouter/anthropic/claude-3.7-sonnet"

# Ghostty sets TERM automatically; keep truecolor support
# For tmux, ensure TERM is properly set in tmux.conf

